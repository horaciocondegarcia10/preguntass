<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Pastel Interactivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #BF9CFC; /* Lavanda */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #FFFFFF;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 500px;
            text-align: center;
            border: 2px solid #D1EEFF; /* Borde pastel */
        }
        .question-text {
            font-family: 'Pacifico', cursive; /* Fuente más estilizada para las preguntas */
            font-size: 1.875rem; /* text-3xl */
            color: #FC9FFF; /* lavanda claro */
            margin-bottom: 2rem;
        }
        .answer-button {
            background-color: #FFDAB9; /* Melocotón pastel */
            color: #8B4513; /* Marrón suave para contraste */
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px; /* Botones pill-shaped */
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .answer-button:hover {
            background-color: #FFC0CB; /* Rosa pastel al pasar el ratón */
            transform: translateY(-2px);
        }
        .message-text {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            color: #9370DB; /* Morado claro pastel */
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        .next-button {
            background-color: #C1FFC1; /* Verde menta pastel */
            color: #3CB371; /* Verde medio para contraste */
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 9999px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .next-button:hover {
            background-color: #AEEEEE; /* Turquesa pastel al pasar el ratón */
            transform: translateY(-2px);
        }
        .hidden {
            display: none;
        }
        /* Estilo para el contenedor del mapa */
        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 1rem;
            margin-top: 1rem;
            border: 2px solid #D1EEFF;
            background-color: #f9f9f9; /* Color de fondo mientras carga */
        }
    </style>
</head>
<body>

    <div class="container">

        <!-- 1. Pantalla de Inicio -->
        <div id="screen1" class="quiz-screen">
            <p class="question-text">Mira a quien tienes junto a ti</p>
            <button class="answer-button" onclick="showScreen('message1')">Listoo</button>
        </div>

        <!-- 2. Mensaje de Inicio -->
        <div id="message1" class="quiz-screen hidden">
            <p class="message-text">El esta muy enamorado de ti, aunque a veces no sepa como tratarte :(</p>
            <button class="answer-button" onclick="showScreen('message1_b')">Yo tambien lo amo <3</button>
            <button class="answer-button" onclick="showScreen('message1_alt')">Ya no lo quiero tanto la verdad</button>
        </div>

        <!-- 3. Mensaje Alternativo (si no lo quiere) -->
        <div id="message1_alt" class="quiz-screen hidden">
            <p class="message-text">Ahora tu futuro noviecito ta tite :( -3 puntos de felicidad</p>
            
            <!-- Placeholder para la imagen -->
            <div class="my-4">
                <!-- REEMPLAZA 'TU_IMAGEN.jpg' con la URL o ruta a tu imagen -->
                <img src="ratita.jpg" alt="Imagen triste" class="rounded-lg border-2 border-gray-200 shadow-inner w-full max-w-xs mx-auto">
            </div>

            <button class="next-button" onclick="showScreen('message1_b')">Ni modos</button>
        </div>
        
        <!-- 4. Pantalla del Video -->
        <div id="message1_b" class="quiz-screen hidden">
            <p class="message-text">Te acuerdasss??</p>
            
            <!-- Placeholder para el video -->
            <div class="my-4">
                <!-- REEMPLAZA 'TU_VIDEO.mp4' con la URL o ruta a tu video -->
                <!-- Asegúrate de subir tu video al hosting (ej. Amplify) y poner la ruta correcta aquí -->
                <video width="100%" controls class="rounded-lg border-2 border-gray-200 shadow-inner">
                    <source src="video.mp4" type="video/mp4">
                    Tu navegador no soporta el tag de video.
                </video>
            </div>

            <button class="answer-button" onclick="showScreen('message1_b_yes')">Sii, me acuerdoo jsjsjsjs (menso)</button>
            <button class="answer-button" onclick="showScreen('message1_b_no')">Nono no me acuerdo</button>
        </div>

        <!-- 5. Respuesta al Video (Sí) -->
        <div id="message1_b_yes" class="quiz-screen hidden">
            <p class="message-text">Ese es uno de los dias de su vida que nunca va a olvidar jsjsjjs +3 de felicidad</p>
            <button class="next-button" onclick="showScreen('screen2')"><333</button>
        </div>

        <!-- 6. Respuesta al Video (No) -->
        <div id="message1_b_no" class="quiz-screen hidden">
            <p class="message-text">Nuuuu por quee no te acuerdas?? -3 puntos de felicidad</p>
            <button class="next-button" onclick="showScreen('screen2')">Zzz</button>
        </div>

        <!-- 7. Segunda Pregunta (Menso) -->
        <div id="screen2" class="quiz-screen hidden">
            <p class="question-text">Sabias que está medio menso</p>
            <button class="answer-button" onclick="showScreen('message2')">Estoy de acuerdo</button>
            <button class="answer-button" onclick="showScreen('message2_b')">No tanto</button>
            <button class="answer-button" onclick="showScreen('message2_c')">Si, mucho, pero así me agrada <3</button>
        </div>

        <!-- 8. Respuesta 2-A (Estoy de acuerdo) -->
        <div id="message2" class="quiz-screen hidden">
            <p class="message-text">Pero no le digas tan feo que se pone tite -3 de felicidad</p>
            <button class="next-button" onclick="showScreen('screen3')">Tenkiu next</button>
        </div>

        <!-- 9. Respuesta 2-B (No tanto) -->
        <div id="message2_b" class="quiz-screen hidden">
            <p class="message-text">Bueno, un poquito entonces XD</p>
            <button class="next-button" onclick="showScreen('screen3')">Mejor comprame un fraiche</button>
        </div>

        <!-- 10. Respuesta 2-C (Si mucho) -->
        <div id="message2_c" class="quiz-screen hidden">
            <p class="message-text">Acabas de poner mas feliz a tu futuro novio, +5 puntos de felicidad</p>
            <button class="next-button" onclick="showScreen('screen3')">Te amoo muakk <3</button>
        </div>
        
        <!-- 11. Tercera Pregunta (Reto) -->
        <div id="screen3" class="quiz-screen hidden">
            <p class="question-text">Aceptass?</p>
            <button class="answer-button" onclick="showScreen('message3_a')">Siii</button>
            <button class="answer-button" onclick="showScreen('message3_b')">Nooo</button>
        </div>

        <!-- 12. Respuesta 3-A (Sí) -->
        <div id="message3_a" class="quiz-screen hidden">
            <p class="message-text">Sii *C emociona*</p>
            <button class="next-button" onclick="startMapChallenge()">Vamoss!!</button>
        </div>

        <!-- 13. Respuesta 3-B (No) -->
        <div id="message3_b" class="quiz-screen hidden">
            <p class="message-text">No has conseguido los puntos de felicidad necesarios para continuar, tu futuro novio esta ahora muy triste, alegralo!!</p>
            <button class="next-button" onclick="showScreen('screen1')">Reintentar</button>
        </div>

        <!-- 14. Pantalla del Mapa -->
        <div id="mapChallengeScreen" class="quiz-screen hidden">
            <p class="question-text">Ahora debes llegar a los puntos marcados en el mapa!!</p>
            <div id="map" class="map-container"></div>
            <p id="map-status" class="message-text mt-4">Inicializando mapa y buscando tu ubicación...</p>
        </div>

        <!-- 15. Pantalla de Reto Completado -->
        <div id="mapChallengeComplete" class="quiz-screen hidden">
            <p class="question-text">Apoco si tilina??</p>
            <p class="message-text">Completaste y encontraste los dos lugares y mira donde estamos, donde esto empezo hace un año</p>
            <button class="next-button" onclick="showScreen('finalScreen')">jsjsjsjsjjs</button>
        </div>

        <!-- 16. Pantalla Final -->
        <div id="finalScreen" class="quiz-screen hidden">
            <p class="question-text">¡Hemos llegado al final de las preguntas por ahora!</p>
            <p class="message-text">Aquí es donde iría el contenido de tu siguiente pantalla.</p>
        </div>

    </div>

    <script>
        // --- Variables Globales para el Mapa ---
        let map;
        let userMarker;
        let targetMarker;
        let watchId;
        let currentChallenge = 'A';

        // --- PUNTOS DEL RETO (¡Modifica estas coordenadas!) ---
        // He usado Zócalo (A) y Bellas Artes (B) en CDMX como placeholders.
        const point_A = { lat: 19.51466914114327, lng: -96.9158149698694 }; 
        const point_B = { lat: 19.4354, lng: -99.1412 }; 

        // Función para mostrar una pantalla y ocultar las demás
        function showScreen(screenId) {
            const screens = document.querySelectorAll('.quiz-screen');
            screens.forEach(screen => {
                screen.classList.add('hidden');
            });

            document.getElementById(screenId).classList.remove('hidden');
        }

        // --- LÓGICA DEL MAPA Y GEOLOCALIZACIÓN ---

        // 1. Función para iniciar el reto
        function startMapChallenge() {
            showScreen('mapChallengeScreen');
            
            // Revisa si el script de Google Maps ya se cargó
            if (typeof google === 'object' && typeof google.maps === 'object') {
                initMap();
            } else {
                // Si no se ha cargado (por el 'defer'), initMap() será llamado por el callback
                // Pero si el usuario recarga en esta pantalla, necesitamos un plan B.
                // El callback 'initMap' en la URL del script se encargará de esto la primera vez.
                 document.getElementById('map-status').textContent = 'Cargando API de Google Maps...';
                 // El script en el head llamará a 'initMap' cuando esté listo.
                 // Vamos a forzar la inicialización por si acaso
                 if (!window.googleMapsApiLoaded) {
                    initMap(); // Intenta inicializar
                 }
            }
        }

        // 2. Función de Callback de Google Maps (se llama cuando la API está lista)
        function initMap() {
            window.googleMapsApiLoaded = true; // Marca que la API se cargó
            
            // Asegurarnos que estamos en la pantalla del mapa
            if (document.getElementById('mapChallengeScreen').classList.contains('hidden')) {
                return; // No inicializar si no estamos en la pantalla correcta
            }

            try {
                map = new google.maps.Map(document.getElementById("map"), {
                    center: point_A,
                    zoom: 18,
                    mapTypeId: 'satellite' // Vista de satélite para más diversión
                });

                targetMarker = new google.maps.Marker({
                    position: point_A,
                    map: map,
                    title: "¡Punto A!",
                    icon: {
                        url: "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png"
                    }
                });

                userMarker = new google.maps.Marker({
                    map: map,
                    title: "¡Tú estás aquí!",
                    icon: {
                        url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                    }
                });

                document.getElementById('map-status').textContent = 'Mapa cargado. Obteniendo tu ubicación...';
                startGeolocation();

            } catch (e) {
                document.getElementById('map-status').textContent = 'Error al cargar Google Maps. ¿La API Key es correcta?';
                console.error(e);
            }
        }

        // 3. Iniciar el rastreo de geolocalización
        function startGeolocation() {
            if (navigator.geolocation) {
                watchId = navigator.geolocation.watchPosition(
                    locationUpdate, 
                    locationError, 
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            } else {
                document.getElementById('map-status').textContent = "Tu navegador no soporta geolocalización.";
            }
        }

        // 4. Función que se llama cada vez que la ubicación cambia
        function locationUpdate(position) {
            const userCoords = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            // Actualiza el marcador del usuario
            if (userMarker) {
                userMarker.setPosition(userCoords);
                map.panTo(userCoords); // Centra el mapa en el usuario
            }

            let targetCoords = (currentChallenge === 'A') ? point_A : point_B;
            let distance = haversineDistance(userCoords, targetCoords);

            document.getElementById('map-status').textContent = `Estás a ${distance.toFixed(1)} metros del Punto ${currentChallenge}.`;

            // 5. Comprobar si se ha alcanzado el objetivo
            if (distance < 5) { // 5 metros de radio
                if (currentChallenge === 'A') {
                    // ¡Encontrado Punto A! Ahora buscar Punto B
                    currentChallenge = 'B';
                    document.getElementById('map-status').textContent = '¡Punto A encontrado! Ahora busca el Punto B...';
                    targetMarker.setPosition(point_B); // Mueve el marcador al Punto B
                    targetMarker.setTitle("¡Punto B!");
                    map.setCenter(point_B); // Centra el mapa en el nuevo punto
                } else {
                    // ¡Encontrado Punto B! Reto completado
                    navigator.geolocation.clearWatch(watchId); // Detener rastreo
                    showScreen('mapChallengeComplete');
                }
            }
        }

        // 6. Manejo de errores de geolocalización
        function locationError(error) {
            let status = document.getElementById('map-status');
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    status.textContent = "Negaste el permiso de ubicación. No podemos continuar el reto.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    status.textContent = "La información de ubicación no está disponible.";
                    break;
                case error.TIMEOUT:
                    status.textContent = "Se agotó el tiempo de espera para obtener la ubicación.";
                    break;
                case error.UNKNOWN_ERROR:
                    status.textContent = "Ocurrió un error desconocido.";
                    break;
            }
        }

        // 7. Fórmula de Haversine para calcular distancia en metros
        function haversineDistance(coords1, coords2) {
            const R = 6371e3; // Radio de la Tierra en metros
            const lat1 = coords1.lat * Math.PI / 180; // φ, λ en radianes
            const lat2 = coords2.lat * Math.PI / 180;
            const deltaLat = (coords2.lat - coords1.lat) * Math.PI / 180;
            const deltaLng = (coords2.lng - coords1.lng) * Math.PI / 180;

            const a = Math.sin(deltaLat / 2) * Math.sin(deltaLat / 2) +
                      Math.cos(lat1) * Math.cos(lat2) *
                      Math.sin(deltaLng / 2) * Math.sin(deltaLng / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distancia en metros
        }


        // Mostrar la primera pantalla al cargar la página
        document.addEventListener('DOMContentLoaded', () => {
            showScreen('screen1');
        });
    </script>

    <!-- Script de Google Maps API 
         ¡¡¡RECUERDA REEMPLAZAR 'TU_API_KEY_AQUI'!!! 
         El 'callback=initMap' es crucial. -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=TU_API_KEY_AQUI&callback=initMap">
    </script>
</body>
</html>